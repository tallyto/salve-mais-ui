<h2 mat-dialog-title>{{ data ? 'Editar Meta' : 'Nova Meta' }}</h2>

<mat-dialog-content>
  <form [formGroup]="metaForm" class="meta-form">
    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Nome da Meta</mat-label>
        <input matInput formControlName="nome" placeholder="Ex: Viagem para Europa">
        <mat-error *ngIf="metaForm.get('nome')?.hasError('required')">
          Nome é obrigatório
        </mat-error>
      </mat-form-field>
    </div>

    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Descrição</mat-label>
        <textarea matInput formControlName="descricao" rows="3" 
                  placeholder="Descreva sua meta..."></textarea>
      </mat-form-field>
    </div>

    <div class="form-row two-columns">
      <mat-form-field appearance="outline">
        <mat-label>Valor Alvo</mat-label>
        <input matInput type="number" formControlName="valorAlvo" placeholder="0.00">
        <span matPrefix>R$&nbsp;</span>
        <mat-error *ngIf="metaForm.get('valorAlvo')?.hasError('required')">
          Valor é obrigatório
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Valor Atual</mat-label>
        <input matInput type="number" formControlName="valorAtual" placeholder="0.00">
        <span matPrefix>R$&nbsp;</span>
      </mat-form-field>
    </div>

    <div class="form-row two-columns">
      <mat-form-field appearance="outline">
        <mat-label>Data Início</mat-label>
        <input matInput type="date" formControlName="dataInicio">
        <mat-error *ngIf="metaForm.get('dataInicio')?.hasError('required')">
          Data de início é obrigatória
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Data Alvo</mat-label>
        <input matInput type="date" formControlName="dataAlvo">
        <mat-error *ngIf="metaForm.get('dataAlvo')?.hasError('required')">
          Data alvo é obrigatória
        </mat-error>
      </mat-form-field>
    </div>

    <div class="form-row two-columns">
      <mat-form-field appearance="outline">
        <mat-label>Categoria</mat-label>
        <mat-select formControlName="categoriaId">
          <mat-option [value]="null">Sem categoria</mat-option>
          <mat-option *ngFor="let categoria of categorias" [value]="categoria.id">
            {{ categoria.nome }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Status</mat-label>
        <mat-select formControlName="status">
          <mat-option *ngFor="let status of statusOptions" [value]="status">
            {{ status }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="form-row">
      <div class="icon-selector">
        <label>Ícone:</label>
        <div class="icon-options">
          <button type="button" 
                  *ngFor="let icone of iconeOptions"
                  mat-mini-fab
                  [class.selected]="metaForm.get('icone')?.value === icone"
                  (click)="metaForm.patchValue({icone: icone})">
            <mat-icon>{{ icone }}</mat-icon>
          </button>
        </div>
      </div>
    </div>

    <div class="form-row">
      <div class="color-selector">
        <label>Cor:</label>
        <div class="color-options">
          <button type="button"
                  *ngFor="let cor of corOptions"
                  class="color-button"
                  [style.background-color]="cor"
                  [class.selected]="metaForm.get('cor')?.value === cor"
                  (click)="metaForm.patchValue({cor: cor})">
          </button>
        </div>
      </div>
    </div>

    <div class="form-row">
      <mat-checkbox formControlName="notificarProgresso">
        Notificar quando atingir marcos de progresso
      </mat-checkbox>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="cancelar()">Cancelar</button>
  <button mat-raised-button color="primary" (click)="salvar()" [disabled]="!metaForm.valid">
    {{ data ? 'Atualizar' : 'Criar' }}
  </button>
</mat-dialog-actions>
