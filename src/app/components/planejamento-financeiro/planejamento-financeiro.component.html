<div class="container">
  <h2>Planejamento Financeiro</h2>

  <div *ngIf="isLoading" class="loading-spinner">
    <mat-spinner></mat-spinner>
  </div>

  <div *ngIf="!isLoading">
    <!-- Estatísticas -->
    <div class="stats-grid">
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon metas">
            <mat-icon>flag</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ totalMetas }}</h3>
            <p>Metas Totais</p>
            <span class="stat-detail">{{ metasEmAndamento }} em andamento</span>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon concluido">
            <mat-icon>check_circle</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ metasConcluidas }}</h3>
            <p>Metas Concluídas</p>
            <span class="stat-detail">{{ (metasConcluidas / totalMetas * 100) || 0 | number:'1.0-0' }}% do total</span>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon planos">
            <mat-icon>shopping_cart</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ totalPlanos }}</h3>
            <p>Planos de Compra</p>
            <span class="stat-detail">{{ planosEmAndamento }} em andamento</span>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon concluido">
            <mat-icon>done_all</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ planosConcluidos }}</h3>
            <p>Planos Concluídos</p>
            <span class="stat-detail">{{ (planosConcluidos / totalPlanos * 100) || 0 | number:'1.0-0' }}% do total</span>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Metas em Andamento -->
    <mat-card class="section-card">
      <mat-card-header>
        <mat-card-title>
          <div class="section-header">
            <h3>Metas em Andamento</h3>
            <button mat-button color="primary" (click)="navegarParaMetas()">
              Ver Todas
              <mat-icon>arrow_forward</mat-icon>
            </button>
          </div>
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div *ngIf="metas.length === 0" class="empty-state">
          <mat-icon>flag</mat-icon>
          <p>Nenhuma meta em andamento</p>
          <button mat-raised-button color="primary" (click)="navegarParaMetas()">
            Criar Nova Meta
          </button>
        </div>

        <div class="metas-grid" *ngIf="metas.length > 0">
          <mat-card *ngFor="let meta of metas" class="meta-card">
            <mat-card-content>
              <div class="meta-header">
                <mat-icon [style.color]="meta.cor || '#3f51b5'">{{ meta.icone || 'flag' }}</mat-icon>
                <h4>{{ meta.nome }}</h4>
              </div>
              <div class="meta-valores">
                <div class="valor-item">
                  <span>{{ meta.valorAtual | currency:'BRL' }}</span>
                  <span class="separador">/</span>
                  <span>{{ meta.valorAlvo | currency:'BRL' }}</span>
                </div>
              </div>
              <div class="progress-section">
                <mat-progress-bar 
                  mode="determinate" 
                  [value]="meta.percentualConcluido || 0"
                  [color]="getProgressColor(meta.percentualConcluido || 0)">
                </mat-progress-bar>
                <span class="progress-text">{{ meta.percentualConcluido || 0 | number:'1.0-0' }}%</span>
              </div>
              <div class="meta-footer">
                <span class="data">
                  <mat-icon>event</mat-icon>
                  {{ meta.dataAlvo | date:'dd/MM/yyyy' }}
                </span>
                <span class="dias" *ngIf="meta.diasRestantes !== undefined">
                  {{ meta.diasRestantes }} dias
                </span>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Planos de Compra -->
    <mat-card class="section-card">
      <mat-card-header>
        <mat-card-title>
          <div class="section-header">
            <h3>Próximos Planos de Compra</h3>
            <button mat-button color="primary" (click)="navegarParaPlanos()">
              Ver Todos
              <mat-icon>arrow_forward</mat-icon>
            </button>
          </div>
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div *ngIf="planos.length === 0" class="empty-state">
          <mat-icon>shopping_cart</mat-icon>
          <p>Nenhum plano de compra cadastrado</p>
          <button mat-raised-button color="primary" (click)="navegarParaPlanos()">
            Criar Novo Plano
          </button>
        </div>

        <div class="planos-list" *ngIf="planos.length > 0">
          <div *ngFor="let plano of planos" class="plano-item">
            <div class="plano-info">
              <h4>{{ plano.nome }}</h4>
              <p class="plano-tipo">{{ plano.tipoCompra }}</p>
            </div>
            <div class="plano-valores">
              <span class="valor-principal">{{ plano.valorTotal | currency:'BRL' }}</span>
              <div class="progresso-mini">
                <mat-progress-bar 
                  mode="determinate" 
                  [value]="calcularPercentualPlano(plano)"
                  [color]="getProgressColor(calcularPercentualPlano(plano))">
                </mat-progress-bar>
                <span>{{ calcularPercentualPlano(plano) | number:'1.0-0' }}%</span>
              </div>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
