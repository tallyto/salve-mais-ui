<h2 mat-dialog-title>Atualizar Progresso</h2>

<mat-dialog-content>
  <div class="meta-info">
    <h3>{{ meta.nome }}</h3>
    <div class="meta-valores">
      <div class="valor-item">
        <span class="label">Valor Alvo:</span>
        <span class="valor">{{ meta.valorAlvo | currency:'BRL' }}</span>
      </div>
      <div class="valor-item">
        <span class="label">Valor Atual:</span>
        <span class="valor">{{ meta.valorAtual | currency:'BRL' }}</span>
      </div>
      <div class="valor-item">
        <span class="label">Falta:</span>
        <span class="valor destaque">{{ valorRestante | currency:'BRL' }}</span>
      </div>
    </div>

    <div class="progresso-atual">
      <mat-progress-bar 
        mode="determinate" 
        [value]="meta.percentualConcluido || 0"
        color="primary">
      </mat-progress-bar>
      <span class="percentual">{{ meta.percentualConcluido || 0 | number:'1.0-0' }}%</span>
    </div>
  </div>

  <form [formGroup]="progressoForm" class="progresso-form">
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Valor a Adicionar</mat-label>
      <input matInput type="text" formControlName="valor" placeholder="0,00" appCurrencyInput>
      <span matPrefix>R$&nbsp;</span>
      <mat-error *ngIf="progressoForm.get('valor')?.hasError('required')">
        Valor é obrigatório
      </mat-error>
      <mat-error *ngIf="progressoForm.get('valor')?.hasError('min')">
        Valor deve ser maior que zero
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Descrição (opcional)</mat-label>
      <textarea matInput formControlName="descricao" rows="2" 
                placeholder="Ex: Depósito mensal, bônus recebido..."></textarea>
    </mat-form-field>

    <div class="preview" *ngIf="progressoForm.get('valor')?.value > 0">
      <h4>Previsão após adicionar:</h4>
      <div class="preview-valores">
        <div class="valor-item">
          <span class="label">Novo Valor:</span>
          <span class="valor">{{ novoValor | currency:'BRL' }}</span>
        </div>
        <div class="valor-item">
          <span class="label">Novo Progresso:</span>
          <span class="valor destaque">{{ novoPercentual | number:'1.0-0' }}%</span>
        </div>
      </div>
      <mat-progress-bar 
        mode="determinate" 
        [value]="novoPercentual"
        [color]="novoPercentual >= 100 ? 'accent' : 'primary'">
      </mat-progress-bar>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="cancelar()">Cancelar</button>
  <button mat-raised-button color="primary" (click)="salvar()" [disabled]="!progressoForm.valid">
    Atualizar
  </button>
</mat-dialog-actions>
