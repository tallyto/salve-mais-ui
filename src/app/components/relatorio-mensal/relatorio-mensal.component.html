<div class="container">
  <!-- Cabeçalho da página -->
  <div class="header">
    <div class="header-content">
      <mat-icon class="header-icon">insights</mat-icon>
      <div class="header-text">
        <h2 class="page-title">Relatório Mensal</h2>
        <div class="dashboard-date text-color-secondary" *ngIf="relatorioData">
          <mat-icon>calendar_today</mat-icon> {{relatorioData.mesReferencia}} - Análise detalhada de suas finanças
        </div>
      </div>
    </div>
  </div>

  <!-- Filtros de Mês e Ano -->
  <div class="filters-container">
    <div class="filters-header">
      <h3 class="filters-title">{{ getSelectedPeriodText() }}</h3>
      
      <!-- Navegação Rápida -->
      <div class="period-navigation">
        <button mat-icon-button matTooltip="Mês anterior" (click)="previousMonth()" [disabled]="isLoading">
          <mat-icon>chevron_left</mat-icon>
        </button>
        <button mat-icon-button matTooltip="Próximo mês" (click)="nextMonth()" [disabled]="isLoading">
          <mat-icon>chevron_right</mat-icon>
        </button>
      </div>
    </div>

    <div class="filters-row">
      <!-- Seleção de Mês e Ano -->
      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Mês</mat-label>
        <mat-select [(value)]="selectedMonth" (selectionChange)="onFilterChange()">
          <mat-option *ngFor="let month of months" [value]="month.value">
            {{ month.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Ano</mat-label>
        <mat-select [(value)]="selectedYear" (selectionChange)="onFilterChange()">
          <mat-option *ngFor="let year of anos" [value]="year">
            {{ year }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Atalhos Rápidos -->
      <div class="quick-filters">
        <button 
          mat-button 
          (click)="resetFilters()" 
          [class.active]="isCurrentMonth()"
          [disabled]="isLoading">
          Hoje
        </button>
        <button 
          mat-button 
          (click)="setLastMonth()" 
          [class.active]="isLastMonth()"
          [disabled]="isLoading">
          Mês Passado
        </button>
        <button 
          mat-button 
          (click)="setNextMonth()" 
          [class.active]="isNextMonth()"
          [disabled]="isLoading">
          Próximo
        </button>
      </div>
    </div>
  </div>

  <!-- Indicador de carregamento -->
  <div *ngIf="isLoading" class="loading-overlay">
    <mat-spinner diameter="50"></mat-spinner>
  </div>

  <!-- Conteúdo do relatório -->
  <div *ngIf="!isLoading && relatorioData">

    <!-- Resumo Financeiro -->
    <div class="card">
      <div class="card-header">
        <div class="header-title">
          <mat-icon>account_balance_wallet</mat-icon>
          <h2 class="section-title">Resumo Financeiro</h2>
        </div>
      </div>
      <div class="card-content">
        <div class="resumo-grid">
          <div class="resumo-item receitas">
            <mat-icon>trending_up</mat-icon>
            <div class="valor-info">
              <span class="label">Total Proventos</span>
              <span class="valor">{{formatarMoeda(relatorioData.resumoFinanceiro.totalProventos)}}</span>
            </div>
          </div>

          <div class="resumo-item despesas">
            <mat-icon>trending_down</mat-icon>
            <div class="valor-info">
              <span class="label">Total Gastos Fixos</span>
              <span class="valor">{{formatarMoeda(relatorioData.resumoFinanceiro.totalGastosFixos)}}</span>
            </div>
          </div>

          <div class="resumo-item cartoes">
            <mat-icon>credit_card</mat-icon>
            <div class="valor-info">
              <span class="label">Total Cartões</span>
              <span class="valor">{{formatarMoeda(relatorioData.resumoFinanceiro.totalCartoes)}}</span>
            </div>
          </div>

          <div class="resumo-item saldo" [class.negativo]="relatorioData.saldoFinal < 0">
            <mat-icon>account_balance</mat-icon>
            <div class="valor-info">
              <span class="label">Saldo Final</span>
              <span class="valor">{{formatarMoeda(relatorioData.saldoFinal)}}</span>
            </div>
          </div>

          <div class="resumo-item dividas" *ngIf="relatorioData.totalDividas > 0">
            <mat-icon>warning</mat-icon>
            <div class="valor-info">
              <span class="label">Total Dívidas</span>
              <span class="valor">{{formatarMoeda(relatorioData.totalDividas)}}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Proventos -->
    <div class="card" *ngIf="relatorioData.proventos.length > 0">
      <div class="card-header">
        <div class="header-title">
          <mat-icon>payments</mat-icon>
          <h2 class="section-title">Proventos ({{relatorioData.proventos.length}})</h2>
        </div>
      </div>
      <div class="card-content">
        <div class="table-container">
          <table mat-table [dataSource]="relatorioData.proventos" class="mat-elevation-z2">
            <ng-container matColumnDef="descricao">
              <th mat-header-cell *matHeaderCellDef>Descrição</th>
              <td mat-cell *matCellDef="let element">{{element.descricao}}</td>
            </ng-container>

            <ng-container matColumnDef="valor">
              <th mat-header-cell *matHeaderCellDef>Valor</th>
              <td mat-cell *matCellDef="let element">{{formatarMoeda(element.valor)}}</td>
            </ng-container>

            <ng-container matColumnDef="data">
              <th mat-header-cell *matHeaderCellDef>Data</th>
              <td mat-cell *matCellDef="let element">{{formatarData(element.data)}}</td>
            </ng-container>

            <ng-container matColumnDef="conta">
              <th mat-header-cell *matHeaderCellDef>Conta</th>
              <td mat-cell *matCellDef="let element">{{element.contaTitular}}</td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="['descricao', 'valor', 'data', 'conta']"></tr>
            <tr mat-row *matRowDef="let row; columns: ['descricao', 'valor', 'data', 'conta']"></tr>
          </table>
        </div>
      </div>
    </div>

    <!-- Gastos Fixos -->
    <div class="card" *ngIf="relatorioData.gastosFixos.length > 0">
      <div class="card-header">
        <div class="header-title">
          <mat-icon>receipt_long</mat-icon>
          <h2 class="section-title">Gastos Fixos ({{relatorioData.gastosFixos.length}})</h2>
        </div>
      </div>
      <div class="card-content">
        <div class="table-container">
          <table mat-table [dataSource]="relatorioData.gastosFixos" class="mat-elevation-z2">
            <ng-container matColumnDef="nome">
              <th mat-header-cell *matHeaderCellDef>Nome</th>
              <td mat-cell *matCellDef="let element">{{element.nome}}</td>
            </ng-container>

            <ng-container matColumnDef="valor">
              <th mat-header-cell *matHeaderCellDef>Valor</th>
              <td mat-cell *matCellDef="let element">{{formatarMoeda(element.valor)}}</td>
            </ng-container>

            <ng-container matColumnDef="vencimento">
              <th mat-header-cell *matHeaderCellDef>Vencimento</th>
              <td mat-cell *matCellDef="let element">{{formatarData(element.vencimento)}}</td>
            </ng-container>

            <ng-container matColumnDef="categoria">
              <th mat-header-cell *matHeaderCellDef>Categoria</th>
              <td mat-cell *matCellDef="let element">{{element.categoria}}</td>
            </ng-container>

              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let element">
                  <span class="status-badge" [ngClass]="getStatusClass(element.pago)">
                    <mat-icon *ngIf="element.pago">check_circle</mat-icon>
                    <mat-icon *ngIf="!element.pago">schedule</mat-icon>
                    {{getStatusText(element.pago)}}
                  </span>
                </td>
              </ng-container>            <tr mat-header-row *matHeaderRowDef="['nome', 'valor', 'vencimento', 'categoria', 'status']"></tr>
            <tr mat-row *matRowDef="let row; columns: ['nome', 'valor', 'vencimento', 'categoria', 'status']"></tr>
          </table>
        </div>
      </div>
    </div>

    <!-- Cartões -->
    <div class="card" *ngIf="relatorioData.cartoes.length > 0">
      <div class="card-header">
        <div class="header-title">
          <mat-icon>credit_card</mat-icon>
          <h2 class="section-title">Cartões ({{relatorioData.cartoes.length}})</h2>
        </div>
      </div>
      <div class="card-content">
        <mat-accordion>
          <mat-expansion-panel *ngFor="let cartao of relatorioData.cartoes" class="cartao-panel">
            <mat-expansion-panel-header>
              <mat-panel-title>
                {{cartao.nomeCartao}}
              </mat-panel-title>
              <mat-panel-description>
                {{formatarMoeda(cartao.valorTotal)}} • Vencimento: {{formatarData(cartao.dataVencimento)}}
              </mat-panel-description>
            </mat-expansion-panel-header>

            <div class="compras-container">
              <table mat-table [dataSource]="cartao.compras" class="mat-elevation-z1">
                <ng-container matColumnDef="descricao">
                  <th mat-header-cell *matHeaderCellDef>Descrição</th>
                  <td mat-cell *matCellDef="let compra">{{compra.descricao}}</td>
                </ng-container>

                <ng-container matColumnDef="valor">
                  <th mat-header-cell *matHeaderCellDef>Valor</th>
                  <td mat-cell *matCellDef="let compra">{{formatarMoeda(compra.valor)}}</td>
                </ng-container>

                <ng-container matColumnDef="data">
                  <th mat-header-cell *matHeaderCellDef>Data</th>
                  <td mat-cell *matCellDef="let compra">{{formatarData(compra.data)}}</td>
                </ng-container>

                <ng-container matColumnDef="categoria">
                  <th mat-header-cell *matHeaderCellDef>Categoria</th>
                  <td mat-cell *matCellDef="let compra">{{compra.categoria}}</td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="['descricao', 'valor', 'data', 'categoria']"></tr>
                <tr mat-row *matRowDef="let row; columns: ['descricao', 'valor', 'data', 'categoria']"></tr>
              </table>
            </div>
          </mat-expansion-panel>
        </mat-accordion>
      </div>
    </div>
  </div>

  <!-- Seção de Contas Vencidas -->
  <div class="card card-vencidas" *ngIf="!isLoading">
    <div class="card-header">
      <div class="header-title">
        <mat-icon>warning</mat-icon>
        <h2 class="section-title">Contas Vencidas</h2>
      </div>
      <span class="section-subtitle">Contas fixas não pagas até hoje</span>
    </div>
    <div class="card-content">
      <div *ngIf="isLoadingContas" class="loading-container">
        <mat-spinner diameter="30"></mat-spinner>
        <p>Carregando contas vencidas...</p>
      </div>

      <div *ngIf="!isLoadingContas && contasVencidas.length === 0" class="empty-state">
        <mat-icon>check_circle</mat-icon>
        <h3>Tudo em dia!</h3>
        <p>Você não possui contas vencidas neste período. Continue assim!</p>
      </div>

      <div *ngIf="!isLoadingContas && contasVencidas.length > 0" class="table-container">
        <table mat-table [dataSource]="contasVencidas" class="mat-elevation-z2">
          <ng-container matColumnDef="nome">
            <th mat-header-cell *matHeaderCellDef>Nome</th>
            <td mat-cell *matCellDef="let element">{{element.nome}}</td>
          </ng-container>

          <ng-container matColumnDef="valor">
            <th mat-header-cell *matHeaderCellDef>Valor</th>
            <td mat-cell *matCellDef="let element">{{formatarMoeda(element.valor)}}</td>
          </ng-container>

          <ng-container matColumnDef="vencimento">
            <th mat-header-cell *matHeaderCellDef>Vencimento</th>
            <td mat-cell *matCellDef="let element">{{formatarData(element.vencimento)}}</td>
          </ng-container>

          <ng-container matColumnDef="categoria">
            <th mat-header-cell *matHeaderCellDef>Categoria</th>
            <td mat-cell *matCellDef="let element">{{element.categoria}}</td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="['nome', 'valor', 'vencimento', 'categoria']"></tr>
          <tr mat-row *matRowDef="let row; columns: ['nome', 'valor', 'vencimento', 'categoria']"></tr>
        </table>
      </div>
    </div>
  </div>
</div>
