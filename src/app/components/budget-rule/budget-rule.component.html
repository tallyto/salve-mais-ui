<div class="budget-rule-container p-fluid">
  <h2 class="section-title">Regra 50/30/20 - Distribuição de Gastos</h2>
  
  <div class="explanation-card mb-4">
    <div class="card">
      <div class="card-header surface-100">
        <h5 class="m-0 font-medium">O que é a regra 50/30/20?</h5>
      </div>
      <div class="card-body">
        <p class="card-text">
          É uma estratégia de orçamento pessoal que divide sua renda em três categorias:
        </p>
        <ul class="pl-3 mt-2">
          <li><strong>50% para necessidades:</strong> Moradia, alimentação, contas básicas, transporte</li>
          <li><strong>30% para desejos:</strong> Lazer, entretenimento, restaurantes, viagens</li>
          <li><strong>20% para economia:</strong> Poupança, investimentos, aposentadoria</li>
        </ul>
      </div>
    </div>
  </div>

  <div *ngIf="loading" class="flex justify-content-center p-4">
    <i class="pi pi-spin pi-spinner" style="font-size: 2rem"></i>
  </div>

  <div *ngIf="error" class="p-message p-message-error">
    <i class="pi pi-times-circle p-message-icon"></i>
    <span>Ocorreu um erro ao carregar os dados da regra 50/30/20. Por favor, tente novamente mais tarde.</span>
  </div>

  <div *ngIf="!loading && !error && budgetData" class="budget-data">
    <!-- Seção de Gráficos com espaçamento adequado -->
    <div class="grid mb-4">
      <!-- Gráfico Ideal -->
      <div class="col-12 md:col-6 p-3">
        <div class="card shadow-1 h-full">
          <div class="card-header surface-100">
            <h5 class="m-0 font-medium">Distribuição Ideal</h5>
          </div>
          <div class="card-body flex align-items-center justify-content-center">
            <div class="chart-wrapper">
              <canvas baseChart
                [data]="idealChartData"
                [options]="chartOptions"
                [type]="'pie'">
              </canvas>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Gráfico Real -->
      <div class="col-12 md:col-6 p-3">
        <div class="card shadow-1 h-full">
          <div class="card-header surface-100">
            <h5 class="m-0 font-medium">Distribuição Real</h5>
          </div>
          <div class="card-body flex align-items-center justify-content-center">
            <div class="chart-wrapper">
              <canvas baseChart
                [data]="realChartData"
                [options]="chartOptions"
                [type]="'pie'">
              </canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Seção de Detalhes -->
    <div class="grid">
      <div class="col-12">
        <div class="card mb-4">
          <div class="card-header surface-100">
            <h5 class="m-0 font-medium">Detalhamento por Categoria</h5>
          </div>
          <div class="card-body">
            <!-- Necessidades -->
            <div class="category-details mb-4">
              <div class="flex justify-content-between align-items-center">
                <h6 class="m-0 necessidades-color">Necessidades (50%)</h6>
                <span [ngClass]="getStatusClass(budgetData.necessidadesStatus)" class="status-badge">
                  {{ getStatusText(budgetData.necessidadesStatus) }}
                </span>
              </div>
              <div class="mt-2 mb-2">
                <div class="progress-bar progress-necessidades" 
                     [ngStyle]="{'width': budgetData.necessidadesPercentual + '%'}"
                     [ngClass]="{'bg-danger': budgetData.necessidadesPercentual > 50}">
                  {{ budgetData.necessidadesPercentual.toFixed(1) }}%
                </div>
              </div>
              <div class="flex justify-content-between text-sm">
                <span>Ideal: R$ {{ budgetData.necessidadesIdeal.toFixed(2) }}</span>
                <span>Real: R$ {{ budgetData.necessidadesReal.toFixed(2) }}</span>
              </div>
              <div [ngClass]="getDiferencaClass('necessidades', budgetData.necessidadesDiferenca)" class="text-sm mt-1">
                {{ getDiferencaText('necessidades', budgetData.necessidadesDiferenca) }}
              </div>
            </div>

            <!-- Desejos -->
            <div class="category-details mb-4">
              <div class="flex justify-content-between align-items-center">
                <h6 class="m-0 desejos-color">Desejos (30%)</h6>
                <span [ngClass]="getStatusClass(budgetData.desejosStatus)" class="status-badge">
                  {{ getStatusText(budgetData.desejosStatus) }}
                </span>
              </div>
              <div class="mt-2 mb-2">
                <div class="progress-bar progress-desejos" 
                     [ngStyle]="{'width': budgetData.desejosPercentual + '%'}"
                     [ngClass]="{'bg-danger': budgetData.desejosPercentual > 30}">
                  {{ budgetData.desejosPercentual.toFixed(1) }}%
                </div>
              </div>
              <div class="flex justify-content-between text-sm">
                <span>Ideal: R$ {{ budgetData.desejosIdeal.toFixed(2) }}</span>
                <span>Real: R$ {{ budgetData.desejosReal.toFixed(2) }}</span>
              </div>
              <div [ngClass]="getDiferencaClass('desejos', budgetData.desejosDiferenca)" class="text-sm mt-1">
                {{ getDiferencaText('desejos', budgetData.desejosDiferenca) }}
              </div>
            </div>

            <!-- Economia -->
            <div class="category-details">
              <div class="flex justify-content-between align-items-center">
                <h6 class="m-0 economia-color">Economia (20%)</h6>
                <span [ngClass]="getStatusClass(budgetData.economiaStatus)" class="status-badge">
                  {{ getStatusText(budgetData.economiaStatus) }}
                </span>
              </div>
              <div class="mt-2 mb-2">
                <div class="progress-bar progress-economia" 
                     [ngStyle]="{'width': budgetData.economiaPercentual + '%'}"
                     [ngClass]="{'bg-danger': budgetData.economiaPercentual < 20}">
                  {{ budgetData.economiaPercentual.toFixed(1) }}%
                </div>
              </div>
              <div class="flex justify-content-between text-sm">
                <span>Ideal: R$ {{ budgetData.economiaIdeal.toFixed(2) }}</span>
                <span>Real: R$ {{ budgetData.economiaReal.toFixed(2) }}</span>
              </div>
              <div [ngClass]="getDiferencaClass('economia', budgetData.economiaDiferenca)" class="text-sm mt-1">
                {{ getDiferencaText('economia', budgetData.economiaDiferenca) }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Dicas - 100% da largura em todas as telas -->
    <div class="grid">
      <div class="col-12">
        <div class="card mb-4">
          <div class="card-header surface-100">
            <h5 class="m-0 font-medium">Dicas para melhorar seu orçamento</h5>
          </div>
          <div class="card-body">
            <div *ngIf="budgetData.necessidadesStatus === 'ACIMA' || budgetData.necessidadesStatus === 'MUITO_ACIMA'">
              <h6 class="m-0 font-medium mb-2">Necessidades acima do limite</h6>
              <ul class="pl-3 mt-2 mb-3">
                <li>Revise gastos fixos como aluguel, contas e financiamentos</li>
                <li>Busque alternativas mais econômicas para serviços essenciais</li>
                <li>Renegocie dívidas para reduzir parcelas mensais</li>
              </ul>
            </div>

            <div *ngIf="budgetData.desejosStatus === 'ACIMA' || budgetData.desejosStatus === 'MUITO_ACIMA'">
              <h6 class="m-0 font-medium mb-2">Desejos acima do limite</h6>
              <ul class="pl-3 mt-2 mb-3">
                <li>Reduza gastos com entretenimento, restaurantes e compras não essenciais</li>
                <li>Procure alternativas mais baratas para lazer</li>
                <li>Estabeleça um limite semanal para gastos discricionários</li>
              </ul>
            </div>

            <div *ngIf="budgetData.economiaStatus === 'ABAIXO' || budgetData.economiaStatus === 'MUITO_ABAIXO'">
              <h6 class="m-0 font-medium mb-2">Economia abaixo do objetivo</h6>
              <ul class="pl-3 mt-2 mb-3">
                <li>Configure transferências automáticas para sua conta de poupança</li>
                <li>Defina metas de economia de curto e médio prazo</li>
                <li>Considere aumentar sua receita com fontes adicionais</li>
              </ul>
            </div>

            <div *ngIf="budgetData.necessidadesStatus === 'DENTRO_DO_LIMITE' && 
                        budgetData.desejosStatus === 'DENTRO_DO_LIMITE' && 
                        (budgetData.economiaStatus === 'ACIMA_DO_OBJETIVO' || budgetData.economiaStatus === 'QUASE_NO_OBJETIVO')">
              <h6 class="m-0 font-medium mb-2">Seu orçamento está equilibrado!</h6>
              <p class="mt-2">Continue acompanhando seus gastos e economias para manter o equilíbrio financeiro.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
